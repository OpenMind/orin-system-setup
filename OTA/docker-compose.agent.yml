version: '3.8'

services:
  ota-agent:
    build:
      context: ..
      dockerfile: Dockerfile
    image: openmindagi/ota:latest
    container_name: ota-agent
    restart: unless-stopped
    environment:
      - OM_API_KEY=${OM_API_KEY}
      - OM_API_KEY_ID=${OM_API_KEY_ID}
      - OTA_SERVER_URL=${OTA_SERVER_URL:-wss://api.openmind.org/api/v1/ota/agent}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /usr/bin/docker:/usr/local/bin/docker:ro
      - /usr/local/bin/docker-compose:/usr/local/bin/docker-compose:ro
      - ./.ota:/app/.ota
    network_mode: host
    command: python -m OTA.agent.main
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
